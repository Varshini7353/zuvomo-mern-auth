import React from 'react';
import { Formik, Field, Form } from 'formik';
import * as Yup from 'yup';
import { api, setAuthToken } from '../api';
import { useNavigate } from 'react-router-dom';

const LoginSchema = Yup.object().shape({
  identifier: Yup.string().required('Required'),
  password: Yup.string().required('Required')
});

export default function Login() {
  const navigate = useNavigate();

  return (
    <div>
      <h3>Login</h3>
      <Formik
        initialValues={{ identifier: '', password: '' }}
        validationSchema={LoginSchema}
        onSubmit={async (values, { setSubmitting, setStatus }) => {
          try {
            const res = await api.post('/auth/login', values);
            setAuthToken(res.data.token);
            setStatus({ success: 'Logged in' });
            navigate('/');
          } catch (err) {
            setStatus({ error: err.response?.data?.msg || 'Login failed' });
          } finally { setSubmitting(false); }
        }}
      >
        {({ isSubmitting, status }) => (
          <Form>
            <div><label>Email or Phone</label><Field name="identifier" /></div>
            <div><label>Password</label><Field type="password" name="password" /></div>

            <button type="submit" disabled={isSubmitting}>Login</button>

            <div style={{ marginTop: 10 }}>
              <a href={${process.env.REACT_APP_API_URL || 'http://localhost:5000/api'}/auth/google}>Login with Google</a><br/>
              <a href={${process.env.REACT_APP_API_URL || 'http://localhost:5000/api'}/auth/linkedin}>Login with LinkedIn</a><br/>
              <a href="/forgot">Forgot password?</a>
            </div>

            {status?.error && <div style={{ color: 'red' }}>{status.error}</div>}
            {status?.success && <div style={{ color: 'green' }}>{status.success}</div>}
          </Form>
        )}
      </Formik>
    </div>
  );
}